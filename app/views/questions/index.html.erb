<div class="content-wraper">
  <div class="ask_question">
    <%= link_to 'What is your question?', new_question_path %>
  </div>

  <% @all_questions.each do |question| %>
      <div id="onclick_hide-<%= question.id %>" class="question_answer">
        <div id="hide_question-<%= question.id %>" style="float: right; cursor: pointer; color: #aaa; ">X</div>
        <div class="question"><%= link_to question.name, question_answers_path(question), :class => 'question_link' %></div>
        <% unless @last_answer_of_all_questions[question.id].nil? %>

            <div id="removing_answer_after_deletion-<%= @last_answer_of_all_questions[question.id].id %>">
              <%= render 'common/user_details', user: @user_of_last_answer[question.id] %><br>
              <span id="updated_answer-<%= @last_answer_of_all_questions[question.id].id%>" ><%= render 'common/answer_details', answer: @last_answer_of_all_questions[question.id] %></span>
            </div>

            <div id="edit_box_and_update_button-<%= @last_answer_of_all_questions[question.id].id %>" class="edit_box_and_update_button_togather" style="display: none">
              <div> <input type="text" value="<%= @last_answer_of_all_questions[question.id].content %>" id="editing_answer_field-<%= @last_answer_of_all_questions[question.id].id%>"  class="update-answer"></div>
              <div> <input type="submit" value="update answer" id="update_answer_btn-<%= @last_answer_of_all_questions[question.id].id %>" class="btn-primary" style="float: right"></div>
            </div>
            <% if @user_of_last_answer[question.id].id  == current_user.id %>
                <div id="three_dot_menu-<%= @last_answer_of_all_questions[question.id].id %>" class="three-dot-menu">
                  <div class="dropup pull-left">
                    <div data-toggle="dropdown">...</div>
                    <ul class="dropdown-menu">
                      <li id="edit_answer-<%= @last_answer_of_all_questions[question.id].id %>"> Edit </li>
                      <li id="delete_answer-<%= @last_answer_of_all_questions[question.id].id %>"> Delete</li>
                    </ul>
                  </div>
                </div>
            <% end %>
        <% end %>
      </div>
  <% end %>

</div>

<script>

    $('[id*="edit_answer-"]').click(function(e){
        e.preventDefault()
        var answer_id = (this.id).substring('edit_answer-'.length)
        var updated_answer = 'updated_answer-' + answer_id
        $('#' + updated_answer).hide()
        var three_dot_menu = 'three_dot_menu-' + answer_id
        $('#' + three_dot_menu).hide()
        var edit_box_and_update_button = 'edit_box_and_update_button-' + answer_id
        $('#' + edit_box_and_update_button).show()
    })

    $('[id*="hide_question-"]').click(function(e){
        e.preventDefault()
        var question_id = (this.id).substring('hide_question-'.length)
        var onclick_hide = 'onclick_hide-' + question_id
        $('#' + onclick_hide).hide()
//
    })

    $('[id*="update_answer_btn-"]').click(function(e){
        e.preventDefault()
        var answer_id = (this.id).substring('update_answer_btn-'.length)
        var editing_answer_field_id = 'editing_answer_field-' + answer_id
        var updating_answer_field_text_value = $('#' + editing_answer_field_id).val()
        $.ajax({
            url: '/questions/:question_id/answers/:id/edit',
            type: 'get',
            datatype: 'json',
            data: {	"answer_id": answer_id, updating_answer_text: updating_answer_field_text_value },
            success: function(response){
                if (response['status'] === true){
                    var updated_answer = 'updated_answer-' + answer_id
                    $('#' + updated_answer).html(updating_answer_field_text_value)
                    $('#' + updated_answer).show()
                    var three_dot_menu = 'three_dot_menu-' + answer_id
                    $('#' + three_dot_menu).show()
                    var edit_box_and_update_button = 'edit_box_and_update_button-' + answer_id
                    $('#' + edit_box_and_update_button).hide()
                }
            }
        }).error(function(){
            alert("something went wrong")
        })
    })

    $('[id*="delete_answer-"]').click(function(e){
        e.preventDefault()
        var answer_id = (this.id).substring('delete_answer-'.length)
        $.ajax({
            url: '/questions/:question_id/answers/:id',
            type: 'delete',
            datatype: 'json',
            data: {	"answer_id": answer_id },
            success: function(response){
                if (response['status'] === true){
                    var removing_answer_field = 'removing_answer_after_deletion-' + answer_id
                    $('#' + removing_answer_field).remove()
                    var three_dot_menu = 'three_dot_menu-' + answer_id
                    $('#' + three_dot_menu).hide()
                }
            }
        }).error(function(){
            alert("something went wrong")
        })
    })
</script>